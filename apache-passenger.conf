# Apache configuration for PIW Pisz with Phusion Passenger
# Place this file in /etc/apache2/sites-available/piw-pisz

<VirtualHost *:80>
    ServerName bippiwpisz.arstudio.atthost24.pl
    ServerAlias www.bippiwpisz.arstudio.atthost24.pl
    
    # Document root
    DocumentRoot /home/arstudio/websites/piw_pisz/public
    
    # Passenger configuration
    PassengerEnabled on
    PassengerAppType node
    PassengerAppRoot /home/arstudio/websites/piw_pisz
    PassengerStartupFile app.js
    PassengerAppEnv production
    PassengerAppGroupName piw_pisz
    PassengerUser arstudio
    
    # Enable friendly error pages for debugging
    PassengerFriendlyErrorPages on
    
    # Set memory limits
    PassengerMaxRequestQueueSize 100
    PassengerMaxRequestQueueTime 60
    
    # Enable logging
    PassengerLogLevel 3
    
    # Static files
    <Directory /home/arstudio/websites/piw_pisz/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # Uploads directory
    <Directory /home/arstudio/websites/piw_pisz/public/uploads>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>
    
    # Downloads directory
    <Directory /home/arstudio/websites/piw_pisz/public/download>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/piw-pisz-error.log
    CustomLog ${APACHE_LOG_DIR}/piw-pisz-access.log combined
    
    # Security headers
    Header always set X-Frame-Options DENY
    Header always set X-Content-Type-Options nosniff
    Header always set Referrer-Policy origin-when-cross-origin
    
    # Gzip compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE application/xhtml+xml
        AddOutputFilterByType DEFLATE application/rss+xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/x-javascript
    </IfModule>
</VirtualHost>

# HTTPS configuration (uncomment after SSL setup)
#<VirtualHost *:443>
#    ServerName bippiwpisz.arstudio.atthost24.pl
#    ServerAlias www.bippiwpisz.arstudio.atthost24.pl
#    
#    # SSL configuration
#    SSLEngine on
#    SSLCertificateFile /etc/letsencrypt/live/bippiwpisz.arstudio.atthost24.pl/fullchain.pem
#    SSLCertificateKeyFile /etc/letsencrypt/live/bippiwpisz.arstudio.atthost24.pl/privkey.pem
#    
#    # Redirect HTTP to HTTPS
#    Redirect permanent / https://bippiwpisz.arstudio.atthost24.pl/
#</VirtualHost>
